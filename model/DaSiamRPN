"""
This docker image is build for DaSiamRPN

GitHub: https://github.com/foolwood/DaSiamRPN
arXiv: https://arxiv.org/pdf/1808.06048.pdf

Requirement:
  python2.7
  pytorch == 0.3.1
  numpy (1.15.3 in this image)
  opencv-python (3.4.0 in this image)
"""
FROM floydhub/pytorch:0.3.1-gpu.cuda9cudnn7-py2.37
LABEL maintainer=afun@afun.tw
SHELL ["/bin/bash", "-c"]

ARG USER_ID
ARG GROUP_ID

# Dynamic build image with current user
# docker build --build-arg USER_ID=$(id -u $USER) --build-arg GROUP_ID=$(id -g $USER) -t afun/mydocker:DaSiamRPN -f DaSiamRPN .
# docker run --rm -it -u $(id -u ${USER}):$(id -g ${USER}) afun/mydocker:DaSiamRPN bash

RUN if [ ${USER_ID:-0} -ne 0 ] && [ ${GROUP_ID:-0} -ne 0 ]; then \
    groupadd -g ${GROUP_ID} dasiamrpn && \
    useradd -r -u ${USER_ID} -g dasiamrpn dasiamrpn; fi

WORKDIR /home/dasiamrpn
RUN /bin/cp /etc/skel/.bashrc /home/dasiamrpn && \
    chown dasiamrpn:dasiamrpn /home/dasiamrpn/.bashrc && \
    chown dasiamrpn:dasiamrpn /home/dasiamrpn
ENV force_color_prompt=yes
USER dasiamrpn
